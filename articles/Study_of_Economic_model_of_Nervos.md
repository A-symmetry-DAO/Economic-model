# Study of [Economic model of Nervos](https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0015-ckb-cryptoeconomics/0015-ckb-cryptoeconomics.md)

##  在 Nervos 的经济模型设计中，提出了 Token 经济设计的三个目标：

  - 如何确保协议的安全性
  - 如何确保协议的长期可持续性
  - 如何让网络的不同参与者目标一致, 从而提高网络价值

## 比特币网络的经济设计

  在比特币网络中，使用其本币（BTC）来激励矿工出块和验证。BTC即是一种实用程序令牌，又是一种加密资产。换句话说，BTC即是“**交换媒介**（MoE: Medium of Exchange）”，可以用来支付交易费；又是“**价值储存**（SoV： Store of Value）”，用作资产保值。

  - **交换媒介**：视比特币网络为点对点价值传递网络，MoE用户不必持币从网络获利，交易本身就是在提供价值。MoE用户不关心价格涨跌，只关心交易费用对应的法币等价成本。比特币网络要成为一个主流的交换媒介网络是很难的。由于出块时间和区块大小是受限的，也就决定了它的交易容量其实是限定的，网络越成功，交易成本会越高，在同类型网络中的竞争力会降低。但是如果要追求低交易费，以及通过快速出块和大区块来提高容量，又会在安全性和去中心化上妥协。

   - **价值储存**：视比特币网络为一种安全协议，保护其资产安全，以便长期保值。SoV用户把交换媒介功能看作是其资产可以自由进出的必要功能。在他们看来，比特币的价值是来源于其网络的安全性以及足够的去中心化，如果网络变得中心化，那么比特币就不再具有独立价值。因此，想要成为一个成功的价值储存网络，就要保证货币政策的稳定和网络的安全与去中心化。

  安全性和去中心化是区块链很重要的两个属性，但是其成本很高，当所有币被挖出来之后，那么这个成本就只能依靠交易费用支付。但是，MoE用户暴露在网络安全风险的时间有限，是不愿意为此支付费用的；而SoV用户是长时间暴露在网络安全风险之下的，是愿意为此支付费用的，但是他们又是几乎不怎么交易的。如果依靠价值储存用户的一次性付费来维持网络安全，是不可持续的。

  在价值储存网络中，通货膨胀为网络的持续安全提供了激励，这种激励是和用户相容的。基于通货膨胀的奖励机制，相当于是从网络的持续安全中获益的人为网络间接做了付费。

## 去中心化和有界状态的需要

  作为一个长期价值储存平台，必须是中立的，不存在审查和没收的风险。资产储存平台有必要采取措施，保护完整节点的运营成本，以确保网络足够的去中心化。比特币和以太坊都限制了交易吞吐量——比特币限制带宽，以太坊限制计算，以确保网络参与的去中心化。但这二者都没有采取有效措施限制全局状态的不断增长，这是参与共识以及独立交易验证所必需的。

  Nervos 提出，一个好的状态管理存储机制需要实现几个目标：

  - 全局状态的增长必须受限，以提供全节点参与的可预测性。而这个成本是在任何非专业人员都可参与的范围内，这样可以使网络更加分散，任何人都可以独立验证历史和状态。

  - 随着全局状态的增长，增加状态的价格和减少它的回报应该由市场来决定。状态存储空闲越大，扩展的成本就该越低；反之，亦然。

  - 系统可以连续不断地从状态用户那里增加收入，以支付矿工提供资源的回报。这既能平衡矿工的经济收入，又能激励用户及早清除不必要的状态。

## Nervos 通用知识库的经济模型

Nervos 通用知识库简称 Nervos CKB，是一个专注于资产存储的区块链网络。从体系结构上讲，它旨在更好的支持链上状态和链下计算；从经济层面，它的目的是提供可持续的安全与去中心化。

- 本币

  通用知识字节，CK Byte。最小单位“CK Shannon”，1 CK Byte = 100_000_000 CK Shannons。CK Bytes以字节表示单元容量，它们使持有者能够占据区块链整体全局状态的一部分，用来存储资产、应用程序状态和其他类型的通用知识。

- 令牌发行

  有两种类型的本币发行：**基础发行和二级发行**。基础发行总量固定，发行计划类似比特币——采用大约每4年减半法。基础发行的所有代币用于奖励矿工，保护网络。二级发行的目的是收取状态租金，发行数量每年都一样，并会一直增发下去，基础发行完毕后，将只剩二级发行。

- 用二级发行和NervosDAO收取状态租金

  本币代表了扩展全局状态的权利，因此在本币发行策略中限制了状态增长。状态存储是有界限的，如同比特币的带宽和以太坊的计算吞吐量，是一种稀缺资源，可以进行市场定价与交易。状态租金为状态存储占用的费用结构增加了必要的时间维度，并不强制定期支付租金，而是采用两步法作为“目标通货膨胀”计划来收取租金：

   - 在基础发行之上，对所有代币持有者加增“通胀税”，即二级发行。使用 CK Bytes 存储状态的用户，以通胀税的形式向矿工支付了状态租金。

   - 非状态存储的 CK Bytes 持有者，同样也会被收取通胀税，但他们可以将本币存入并锁定在 NervosDAO 这个特殊合约中，可以获取利息以弥补这种稀释（通胀）。

  举例：若二级发行时，60%的 CK Bytes 用作了状态存储，35%存入了 NervosDAO 合约，5%保持流通；那么二级发行的代币中60%会奖励给矿工，35%作为 NervosDAO 合约里的利息分配，其余部分（5%）由社区治理机制决定，在达成一致前，这部分二级发行的代币将被烧毁。

- 矿工补偿

  全部区块奖励和交易费。获得所有的基础发行代币，以及部分二级发行代币。基础发行结束后，矿工可以获得独立取交易费之外的状态租金收入，但这种收入与通用知识库的采用息息相关。

- 支付交易费用

  分布式区块链网络的交易能力是有限的，交易费用拥有双重目的：为有限的交易能力建立市场；反垃圾邮件保护。比特币用UTXO的输出与输入的差额表示，以太坊允许用户通过  `gasprice`  指定单个计算的单价，并用 `gaslimit` 为整个交易建立预算。

  为确保去中心化，Nervos CKB 限制了计算和带宽吞吐量，使得用户使用这些系统资源时形成了一种拍卖竞争。交易费用由通过 cell 容量的输出与输入之间的差额体现。
 
  计算单元的数量，称其为 cycles，在全节点中被添加为点对点的信息，矿工可以根据交易费用和计算所需的 cycles 数量对交易排序，实现单个计算周期内收益最大化。

  在Nervos CKB中，即可以使用本币支付交易费，也可以使用用户自定义的代币支付。

- 使用自定义货币支付交易费

  用户可以自由使用其他货币（如稳定币）来支付交易费用，这一概念被称为“经济抽象”。要注意的是，即便是没有明确的协议支持，用户也始终可以同矿工达成一致，用协议之外的其他货币支付交易费。这通常被视为是一种威胁，对于本币只是为了方便处理交易的平台而言，这回剥夺其本币内在价值而导致崩溃。

  使用Nervos CKB，经济抽象是可以的，因为支付方式并没有硬编码在交易中。Nervos 的本币内在价值并不是基于交易支付，经济抽象并不会对其经济模型的稳定性造成威胁。但 Nervos 本币会是大多数用户选择的支付方式，因为 Nervos 网络中拥有资产的每个人都必须持有 Nervos 本币作为其资产占用的状态存储容量。
    
## 为保护而设计的 Nervos CKB 经济模型

Nervos CKB网络专为保护资产和其他类型的通用知识而设计。主要有3个设计目标：
1. 如何确保协议的安全性
2.  如何确保协议的长期可持续性
3. 如何让网络的不同参与者目标一致, 从而提高网络价值

- 协议的安全与可持续

  作为一种“资产存储”协议，Nervos CKB为确保安全做出了三个选择：

  - 本币代表了对状态存储容量的声明。也就是说，在平台存储资产必须持有 Nervos 本币。这给本币创造了一种有效的价值捕获机制，这是“资产存储”平台增长其安全预算唯一可持续的方法。

  - 二级发行确保了矿工补偿是可预测的，这是基于保护需求而非交易需求。这消除了中本聪协议里在区块奖励停止后会出现激励不兼容的问题。这对于将来，若将大部分交易移到第2层后，仅剩一个匮乏的第1层，这也是很重要的。

  - NervosDAO 作为二级发行通胀效应的反作用力，确保了长期代币持有人不会因为二级发行被稀释。

  为了保持去中心化和抗审查特性，必要地限制了协议和全节点的资源需求，通过调节计算吞吐量和带宽来保护节点的运营成本。

- 网络参与者的利益协调

  不同网络参与者的利益需求：

  - 用户希望交易更便宜
  - 开发者希望其应用程序被采用
  - 矿工想要更高的收入
  - 持有者想要代币升值

  这些利益诉求并不一致，有时候是冲突的：更多的采用不会带来更便宜的交易；更便宜的交易不会给矿工带来更多的收入；代币的高价格对交易成本没有帮助（用户不改变费用设置）。

  分布式计算平台通过处理交易提供价值，其代币价格并不会实质性改变网络的内在价值。以太坊作为一个计算平台，引入 gas 将计算价格和 ETH 货币价格脱钩，ETH价格并不会影响以太坊网络的内在价值，ETH代币持有者只能扮演投机者的角色，而不能成为增加网络内在价值的活跃参与者。

  在Nervos CKB中，资产存储用户关心资产安全；开发者希望更多的采用，反映在更多的保留资产中；矿工想要高收入，代币持有者想要代币升值。更高的代币价格满足了每个人的目标——网络将更安全，矿工获得更高的收入，代币持有者获得更好的回报。

- 自举式（Bootstrapping）网络效应与网络增长

  随着越来越多的资产和通用知识被保护，会有更多的Nervos CKB本币被占用，这减少了流通供应，为代币价格提供了积极支撑。二级发行份额的增加与价格的增长，会激励矿工扩大经营规模，使网络更加安全，这增加了网络和本币的内在价值，又会吸引更多的价值储存使用。

  网络采用及网络内在价值的“顺周期”循环为网络提供了强大的增长动力。结合网络价值如何累积到本币，又如何被长期持有者捕获这个过程，Nervos CKB本币提供了很好的价值储存功能，更具有可持续性。

- 在“一级资产（First Class Assets）”平台的开发成本

  以太坊中的顶层抽象是账户，资产表示为智能合约账户中的状态。在Nervos CKB网络中，资产的一级抽象是 cells，其所有权用交易输出的锁定脚本来表示，这个概念称其为“First Class Assets”。与比特币一样，资产是由用户直接拥有，而不是智能合约保管。

  “一级资产”设计使得状态存储成本是由个体用户承担，而不是开发者。若开发者只需要400字节的验证规则代码，就可以创建一个用户自定义资产；而每一个资产所有权记录占用64 字节 。那么无论这个资产有多少拥有者，开发成本都只有 400 CK Bytes。这个成本对开发者来说是适中的，对用户来说，在Nervos CKB网络拥有一个资产的成本是 64 CK Bytes。
  
  未来，这些成本可能会变得昂贵，那么开发者可以依靠借贷来引导其项目；用户则可以将资产转移到Nervos网络中的其他交易区块链上去。详情见 "Nervos Network"。

- 借贷

  Nervos CKB将支持本币借贷，以提高本币（CK Bytes）流动性，这归功于 CKB-VM 和 Cell 模型提供的编程能力。本币效用是通过个人财产来实现，而不是交易，可以在一个确切的时间段内锁定 CK Bytes 实现无风险无抵押的借贷。创业者可以以很低的资本成本在一段时间内开发其原型并证明其商业模式，用户则可以出借代币获取利息。

  借贷利率由市场供需关系决定，但当前的代币使用状况也起着很大作用。可用全局状态利用率越高，用于借贷的代币就越少。这会刺激借贷利率增高，吸引人们释放状态存储中和锁定在NervosDAO中的代币，以赚取收入。这样做的目的是帮助减少全局状态：可用状态利用率越低，可用于借贷的币就越多；借贷利率也随之降低，而鼓励更多的采用。

- Nervos Network

  Nervos CKB 是 Nervos 网络的最底层，具有最高的安全性、去中心化、交易成本和状态存储成本。类似于比特币和以太坊，可以用闪电网络和 plasma 方案进行链下扩容，Nervos CKB 对链下扩容方案也是友好的，允许用户在链下保存和交易资产。当使用链下解决方案时，用户和开发者可以在成本、安全、延迟和活跃性等属性之间做出自己的权衡。

  拥有和交易 Nervos CKB 上的资产具有最高的资本和交易成本，但也是最安全的。它适用于高价值资产和长期资产保护。第2层解决方案为交易吞吐量和状态存储提供扩容能力，但他们可能会引起要么是安全性降低的假设，要么会授权执行额外的批判步骤；同时他们也要求参与者在一定时间窗口内需是在线状态。如果二者都可以接受（像短期内拥有和交易一个低价值资产的情况），Nervos CKB 可以作为其他交易区块链的安全锚，从而有效扩大起交易和状态存储能力。

  如果交易区块链运营者不想引入安全假设，他可以委托在 CKB 上发行高价值资产，在交易区块链上发行低价值资产。他们可以用 CK Bytes 在 CKB上存储来自交易区块链的间歇性的区块承诺、质疑和证明——这些都是保护链下交易认可极其重要的通用知识。
  
## Token 经济模型的应用

Nervos CKB的经济模型提供了一些模块，应用程序开发人员可以直接将其作为自己经济模型的一部分使用。订阅和流动性收入就是两个可能的模块。

- 订阅（Subscriptions）

  重复性支付或者订阅是一种典型的经济模式，可以适用于在区块链上提供有一定时间跨度的服务。其中一个例子就是在第2层解决方案中经常需要的链下交易监控服务。在 Nervos CKB 中，阶段性的服务会要求用户锁定一定数量的本币（CK Bytes）在 NervosDAO 合约中，并在基于订阅的模型中指定服务提供者作为产生利息收入的受益人。用户可以通过提走 NervosDAO 中的代币而终止服务。

  事实上，占据全局状态的资产存储用户可以看作是在向一个以状态大小为计量的订阅服务付费，受益人是提供安全的矿工。

- 流动性收入（Liquidity Income）

  在 Plasma 这种类似的2层解决方案中，一个典型的模式就是：用户把本币存入到第1层智能合约中，换得第2层的交易代币。一个信誉良好的2层运营商，可以让用户承诺一个定期存款，然后用这些存款在借贷市场提供流动性并赚取收入。这使得2层解决方案的运营商在2层服务收费之外获得了额外的收入流。
  
## 交易成本分析

类似于比特币，Nervos CKB 使用基于中本共识的 PoW 机制，详情见"Nervos Consensus Paper"。

共识过程的经济性旨在激励节点参与共识过程，并提供节点可用于优先处理交易的度量。其核心就是在帮助共识节点回答这样一个问题：“如果我有机会生成块，这个交易是否值得包含在下一个块中？”

一个区块产生节点可以通过成本/效益分析来回答这个问题。打包交易的好处是可以收取交易费用，在一个区块中打包一个交易的成本有三个：

  - 费用评估成本（Fee Estimation Cost，**FEC**）：这是节点在打包一个交易时，评估最大可能收益的成本；
  - 交易验证成本（Transaction Verification Cost，**TVC**）：打包无效交易将被共识过程拒绝，因此节点在产生块的时候必须先验证交易，然后再打包；
  - 状态转换成本（State Transition Cost，**STC**）：生成块后，产生块的节点必须执行由交易状态机定义的本地状态转换。

而交易验证，**TVC** 又有两个可能的步骤：

  - **_V<sub>auth</sub>_** : 授权验证成本（Authorization Verification Cost）
  - **_V<sub>st</sub>_** : 状态转换验证成本（State Transition Verification Cost）

我们用 CPC 和 EVC 分别表示**完整过程成本**与**评估验证成本**：

  - **CPC**:  完整过程成本（Complete Processing Cost）
    - **CPC = EVC + STC**

  - **EVC**: 评估验证成本（Estimation and Verification Cost）
    - **EVC = FEC + TVC**

### 比特币交易成本分析

比特币处理交易的成本大致和交易尺寸相称：

![19](https://user-images.githubusercontent.com/32875657/58394035-e26e8900-8073-11e9-9e7c-8dce5685c8da.png)


### 以太坊的交易成本分析

![30](https://user-images.githubusercontent.com/32875657/58394094-34171380-8074-11e9-9bb7-d5ae19b0b86b.png)

![31](https://user-images.githubusercontent.com/32875657/58394097-36796d80-8074-11e9-8dd5-8f5d1efcc7bf.png)

![32](https://user-images.githubusercontent.com/32875657/58394103-3c6f4e80-8074-11e9-9e11-240e026792b3.png)

不同于比特币，以太坊节点的 EVC < CPC。 因为以太坊只计算交易被打包进区块后的最终状态。

### Nervos CKB 的交易成本分析

Nervos CKB 的交易是由输入和输出构成的，这点和比特币类似。因此有与比特币相似的情况：

- _FEC<sub>ckb</sub>_ = _O(N<sub>IO</sub>_)
- _STC<sub>ckb</sub>_ = 0

因为 CKB 的交易包含了交易结果作为输出，因此：

- _EVC<sub>ckb</sub>_ = _CPC<sub>ckb</sub>_ = _FEC<sub>ckb</sub>_ + _TVC<sub>ckb</sub>_

### 计算复杂度度量单位——Cycles

在 CKB 中用”cycle“作为计算复杂性的度量单位，类似于以太坊中的”gas“。Nervos CKB 的 VM 是一个 RISC-V CPU 模拟器，因此这里的 cycles 代表了 VM 中真实的 CPU 计算循环。一个指令的循环数代表了一个指令相对计算成本。Nervos CKB 的交易要求发送者指定验证所需的 cycles 数，节点可以挑选设置一个可接受的 cycle 上限 ——cyclemax，并处理 cycle 数比较少的交易。对于单个的区块，同样引入了 cycles，其值等于所有指定交易的 cycles 总数。 单个区块的 cycles 值不能超过区块最大循环（blockcyclesmax），该值由系统设置并可自动调整。

节点可以将他们的 cyclemax 设置为不同的值。cyclemax 只影响生成块的节点如何接受新的交易，并不影响节点如何接受一个新区块中的交易。因此它不会导致区块验证冲突。一个有效的块需要有效的工作量证明，这个成本阻止了区块生成节点用高 cycles 值去打包无效交易。

下表显示了比特币、以太坊和Nervos CKB的运行时差：


|  | Authorization (_**V<sub>auth</sub>**_） | State Validation (**_V<sub>st</sub>_**) | State Transition（**_ST_**）
----- | ----- | ----- |------
Bitcoin | Generalized | Fixed | None
Ethereum | Fixed | None | Generalized
CKB | Generalized | Generalized | None


以下是比特币、以太坊币和Nervos CKB（_**C<sub>limit</sub>**_：平均 cycle 限制）共识过程中不同部分的计算复杂性总结：


| -  | FEC  | TVC  | RSC  |  EVC | CPC |
---- | ---- | ---- | ---- | ---- | ---- |
Bitcoin |  _O_(_N<sub>IO</sub>_  | _O_(_L<sub>tx</sub>_) | 0 | _O_(_L<sub>tx</sub>_) | _O_(_L<sub>tx</sub>_)
Ethereum | _O(1)_ | _O(L<sub>tx</sub>)_ | _O(G<sub>limit</sub>)_  | _O_(_L<sub>tx</sub>_)  |  _O_(_G<sub>limit</sub>_)
CKB | _O_(_N<sub>IO</sub>_) | _O_(_C<sub>limit</sub>_)  | 0 | _O_(_C<sub>limit</sub>_)  | _O_(_C<sub>limit</sub>_) 

____

## Questions：

1. 持有 Nervos 本币（CK Bytes）才能存储状态，存储状态需要收取状态租金，那么是如何收取租金的？持有的本币（CK Bytes）是返还还是被消耗？

   CK Bytes 以字节表示 cell 容量(cell capacity)，有多少CK Bytes 意味着有多少字节的 cell 容量，通过 Cell Capacity 增发和手续费两部分奖励产生激励。Cell是状态存储的单元，未被占用的 cell capacity 可以转让， 具有流动性。但被占用的 cell capacity 无法转让，失去流动性。cell 使用者需要为状态存储支付流动性成本，使用时间越长，需要支付的流动性成本越高。通过使用流动性成本而非预付费的方式，避免预付费用完导致cell被强制回收。

   Cell 的使用者和所有者可能是不同的，所有者可以帮使用者支付流动性成本。更新 Cell 中的数据或是转让Cell Capacity 则需要支付手续费。共识节点可以设置自己愿意接受手续费水平，交易手续费高低是由市场决定的。手续费也可以由 Cell 所有者代替使用者支付。

2. 二级发行机制是怎样的？二级发行的币是什么币？和 CK Bytes的关系？

   CKB的发行主要有两个部分组成： 基础发行 和 二级发行 。 基础发行和比特币差不多，四年减半，总量有限。 二级发行每年总量固定，可预测的增发（通货膨胀），主要会因为CKB的状态分成三个部分： 
   
   - 正在使用中，处于存储状态的CKB：这部分对应的二级发行会补贴给矿工； 
   - 正在存储于Nervos DAO中的CKB：这部分对应的二级发行会补贴给Nervos DAO中的CKB，用于抗通胀； 
   
   - 处于流通状态，未被使用，未存储于Nervos DAO中的CKB：这部分对应的二级发行，暂定为burn掉，未来可能会根据社区产生新的处理方式。

   > 举个例子，在「已占用的 CKB 占全部 CKB 的 60%，锁定在 NervosDAO 的 CKB 占比 35%，可自由流通的 CKB 占比是 5% 」的状况下：如果二级发行的出块奖励是 100 CKB，那就会有 60 CKB 被分配到矿工手上，35 CKB 分配到 DAO 的合约的持有者手上，5 CKB 将会被交由社区治理处理。

   从这里可以看出二级发行的币就是CKB，同CK Bytes 是一样的。

   二级发行是一种对于状态占用的收费，状态存储会失去CK Bytes 的流通性，而系统另一方面又在二级发行增发，相当于收取了通胀税，可以看作在收租金（也就是说租金是透过二级发行给到矿工的），受益人是矿工。

   [【揭秘CKB发行曲线，要不要进来看看】](https://talk.nervos.org/t/ckb/1452?u=kelly)
   
3. 原生代币CKB 可用于空间租赁，将空间租赁给他人（比如开发者）：代币要转出去么？

   租赁仅仅是把这部分CKB代表的空间租出去，可以通过写一个智能合约，出租方把CKB转到这个智能合约里面，然后合约里面的CKB的使用权归租赁方所有，合约上也可以加入锁定租赁期限，这样出租方必须在租赁期到了之后才能取出其中的CKB。

   Cell Model上面有四个字段：capacity表示Cell容量大小，data 是写入的数据，Typescript可以理解为修改权，Lockscript是所有权。Type和Lock两个字段分开就够够实现保留所有权的同时将修改权给出去。通过一定的设计你能够做到：签了一个合同给对方，这块Cell Rental给你一段时间，Typescript，你可以随意修改。但是 Lockscript 还是我才能用，我保留所有权。然后时间到了Typescript一改，我就能够拿回来了。

4. NervosDAO 

   NervosDAO 是一个写在系统底层的合约，可以自动将 CKB 的二级发行分配给锁定在 NervosDAO 合约里的持币者。如果持币者愿意牺牲代币的流动性，那就可以获得系统的补偿，让持币者不被二级发行给稀释。锁仓利润始终等于整个网络中CKB的通胀率（二级发行量/CKB现有总量），

   根据 Nervos 经济模型提案，原生代币 CKB 的特性是这样的：

   - 它代表的是一种存储空间， CKB 发行总量就是存储空间的上限，所以它是有限资源；
   - 资源是会根据发行政策稳定增加的，如果不把自己的 CKB 锁定在 NervosDAO 里面，那么持有的 CKB 就会被二级发行所稀释；
   - 由于存储空间是开发者所需要的资源，所以开发者对于存储空间的需求、 CKB 在自由市场的供给量与价格，会产生一个博弈市场。

   长期持币者可以从 NervosDAO 中获取利息，抵抗通胀，维持资产的稀有度；中短期持币者可以通过租赁等其他方式抵抗通胀，但 NervosDAO 始终是他们的次选项。对于开发者而言，NervosDAO 的调节功能会利于他们做出好的决策：过多持币者锁定 CKB，供应减少，会导致价格上升，增加开发者成本；当价格上升到一个满意的点时，解锁 CKB 卖出的动机上升，增加供应，导致价格降低。

